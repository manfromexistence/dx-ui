---
title: è‡ªå®šä¹‰èŠ‚ç‚¹
order: 12
---

G6 æä¾›äº†ä¸€ç³»åˆ— [å†…ç½®èŠ‚ç‚¹](/manual/element/node/base-node)ï¼ŒåŒ…å« [circleï¼ˆåœ†å½¢èŠ‚ç‚¹ï¼‰](/manual/element/node/circle)ã€[diamondï¼ˆè±å½¢èŠ‚ç‚¹ï¼‰](/manual/element/node/diamond)ã€[donutï¼ˆç”œç”œåœˆèŠ‚ç‚¹ï¼‰](/manual/element/node/donut)ã€[ellipseï¼ˆæ¤­åœ†èŠ‚ç‚¹ï¼‰](/manual/element/node/ellipse)ã€[hexagonï¼ˆå…­è¾¹å½¢èŠ‚ç‚¹ï¼‰](/manual/element/node/hexagon)ã€[htmlï¼ˆHTMLèŠ‚ç‚¹ï¼‰](/manual/element/node/html)ã€[imageï¼ˆå›¾ç‰‡èŠ‚ç‚¹ï¼‰](/manual/element/node/image)ã€[rectï¼ˆçŸ©å½¢èŠ‚ç‚¹ï¼‰](/manual/element/node/rect)ã€[starï¼ˆæ˜Ÿå½¢èŠ‚ç‚¹ï¼‰](/manual/element/node/star) å’Œ [triangleï¼ˆä¸‰è§’å½¢èŠ‚ç‚¹ï¼‰](/manual/element/node/triangle)ã€‚è¿™äº›å†…ç½®èŠ‚ç‚¹èƒ½å¤Ÿæ»¡è¶³å¤§éƒ¨åˆ†åŸºç¡€åœºæ™¯éœ€æ±‚ã€‚

ä½†åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°è¿™äº›åŸºç¡€èŠ‚ç‚¹æ— æ³•æ»¡è¶³çš„éœ€æ±‚ã€‚è¿™æ—¶ï¼Œä½ éœ€è¦åˆ›å»ºè‡ªå®šä¹‰èŠ‚ç‚¹ã€‚åˆ«æ‹…å¿ƒï¼Œè¿™æ¯”ä½ æƒ³è±¡çš„è¦ç®€å•ï¼

## è‡ªå®šä¹‰èŠ‚ç‚¹çš„æ–¹å¼ <Badge type="warning">é€‰æ‹©åˆé€‚çš„æ–¹å¼</Badge>

åˆ›å»ºè‡ªå®šä¹‰èŠ‚ç‚¹çš„æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§é€”å¾„ï¼š

### 1. ç»§æ‰¿ç°æœ‰èŠ‚ç‚¹ç±»å‹ <Badge type="success">æ¨è</Badge>

è¿™æ˜¯æœ€å¸¸ç”¨çš„æ–¹å¼ï¼Œä½ å¯ä»¥é€‰æ‹©ç»§æ‰¿ä»¥ä¸‹ç±»å‹ä¹‹ä¸€ï¼š

- [`BaseNode`](https://github.com/antvis/G6/blob/v5/packages/g6/src/elements/nodes/base-node.ts) - æœ€åŸºç¡€çš„èŠ‚ç‚¹ç±»ï¼Œæä¾›èŠ‚ç‚¹çš„æ ¸å¿ƒåŠŸèƒ½
- [`Circle`](https://github.com/antvis/G6/blob/v5/packages/g6/src/elements/nodes/circle.ts) - åœ†å½¢èŠ‚ç‚¹
- [`Rect`](https://github.com/antvis/G6/blob/v5/packages/g6/src/elements/nodes/rect.ts) - çŸ©å½¢èŠ‚ç‚¹
- [`Ellipse`](https://github.com/antvis/G6/blob/v5/packages/g6/src/elements/nodes/ellipse.ts) - æ¤­åœ†èŠ‚ç‚¹
- [`Diamond`](https://github.com/antvis/G6/blob/v5/packages/g6/src/elements/nodes/diamond.ts) - è±å½¢èŠ‚ç‚¹
- [`Triangle`](https://github.com/antvis/G6/blob/v5/packages/g6/src/elements/nodes/triangle.ts) - ä¸‰è§’å½¢èŠ‚ç‚¹
- [`Star`](https://github.com/antvis/G6/blob/v5/packages/g6/src/elements/nodes/star.ts) - æ˜Ÿå½¢èŠ‚ç‚¹
- [`Image`](https://github.com/antvis/G6/blob/v5/packages/g6/src/elements/nodes/image.ts) - å›¾ç‰‡èŠ‚ç‚¹
- [`Donut`](https://github.com/antvis/G6/blob/v5/packages/g6/src/elements/nodes/donut.ts) - ç”œç”œåœˆèŠ‚ç‚¹
- [`Hexagon`](https://github.com/antvis/G6/blob/v5/packages/g6/src/elements/nodes/hexagon.ts) - å…­è¾¹å½¢èŠ‚ç‚¹

**ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ç§æ–¹å¼ï¼Ÿ**

- ğŸ“Œ **ä»£ç é‡å°‘**ï¼šå¤ç”¨ç°æœ‰èŠ‚ç‚¹çš„å±æ€§å’Œæ–¹æ³•ï¼Œåªéœ€ä¸“æ³¨äºæ–°å¢åŠŸèƒ½
- ğŸ“Œ **å¼€å‘è¿…é€Ÿ**ï¼šé€‚åˆå¤§å¤šæ•°é¡¹ç›®éœ€æ±‚ï¼Œå¿«é€Ÿå®ç°ä¸šåŠ¡ç›®æ ‡
- ğŸ“Œ **æ˜“äºç»´æŠ¤**ï¼šä»£ç ç»“æ„æ¸…æ™°ï¼Œç»§æ‰¿å…³ç³»æ˜ç¡®

:::tip{title=ç«‹å³å¼€å§‹}
å¦‚æœä½ é€‰æ‹©ç»§æ‰¿ç°æœ‰èŠ‚ç‚¹ç±»å‹ï¼ˆæ¨èï¼‰ï¼Œå¯ä»¥ç›´æ¥è·³åˆ° [ä¸‰æ­¥åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªè‡ªå®šä¹‰èŠ‚ç‚¹](#ä¸‰æ­¥åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªè‡ªå®šä¹‰èŠ‚ç‚¹) å¼€å§‹å®è·µã€‚å¤§éƒ¨åˆ†ç”¨æˆ·éƒ½ä¼šé€‰æ‹©è¿™ç§æ–¹å¼ï¼
:::

### 2. åŸºäº G å›¾å½¢ç³»ç»Ÿä»é›¶å¼€å‘ <Badge>é«˜çº§ç”¨æ³•</Badge>

å¦‚æœç°æœ‰èŠ‚ç‚¹ç±»å‹éƒ½ä¸æ»¡è¶³éœ€æ±‚ï¼Œä½ å¯ä»¥åŸºäº G çš„åº•å±‚å›¾å½¢ç³»ç»Ÿä»é›¶åˆ›å»ºèŠ‚ç‚¹ã€‚

**ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ç§æ–¹å¼ï¼Ÿ**

- ğŸ“Œ **æœ€å¤§è‡ªç”±åº¦**ï¼šå®Œå…¨æ§åˆ¶èŠ‚ç‚¹çš„æ¯ä¸ªç»†èŠ‚ï¼Œå®ç°ä»»æ„å¤æ‚æ•ˆæœ
- ğŸ“Œ **ç‰¹æ®Šéœ€æ±‚**ï¼šç°æœ‰èŠ‚ç‚¹ç±»å‹æ— æ³•æ»¡è¶³çš„é«˜åº¦å®šåˆ¶åœºæ™¯
- ğŸ“Œ **æ€§èƒ½ä¼˜åŒ–**ï¼šé’ˆå¯¹ç‰¹å®šåœºæ™¯çš„æ€§èƒ½ä¼˜åŒ–

:::warning{title=æ³¨æ„äº‹é¡¹}
ä»é›¶å¼€å‘çš„è‡ªå®šä¹‰èŠ‚ç‚¹éœ€è¦è‡ªè¡Œå¤„ç†æ‰€æœ‰ç»†èŠ‚ï¼ŒåŒ…æ‹¬å›¾å½¢ç»˜åˆ¶ã€äº‹ä»¶å“åº”ã€çŠ¶æ€å˜åŒ–ç­‰ï¼Œå¼€å‘éš¾åº¦è¾ƒå¤§ã€‚è¿™é‡Œå¯ä»¥ç›´æ¥å‚è€ƒ [æºç ](https://github.com/antvis/G6/blob/v5/packages/g6/src/elements/nodes/base-node.ts) è¿›è¡Œå®ç°ã€‚
:::

## ä¸‰æ­¥åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªè‡ªå®šä¹‰èŠ‚ç‚¹

è®©æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„ä¾‹å­å¼€å§‹ - åˆ›å»ºä¸€ä¸ª **å¸¦æœ‰ä¸»å‰¯æ ‡é¢˜çš„çŸ©å½¢èŠ‚ç‚¹**ï¼š

```js | ob { pin:false, inject: true }
import { Graph, register, Rect, ExtensionCategory } from '@antv/g6';

// ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºè‡ªå®šä¹‰èŠ‚ç‚¹ç±»
class DualLabelNode extends Rect {
  // å‰¯æ ‡é¢˜æ ·å¼
  getSubtitleStyle(attributes) {
    return {
      x: 0,
      y: 45, // æ”¾åœ¨ä¸»æ ‡é¢˜ä¸‹æ–¹
      text: attributes.subtitle || '',
      fontSize: 12,
      fill: '#666',
      textAlign: 'center',
      textBaseline: 'middle',
    };
  }

  // ç»˜åˆ¶å‰¯æ ‡é¢˜
  drawSubtitleShape(attributes, container) {
    const subtitleStyle = this.getSubtitleStyle(attributes);
    this.upsert('subtitle', 'text', subtitleStyle, container);
  }

  // æ¸²æŸ“æ–¹æ³•
  render(attributes = this.parsedAttributes, container) {
    // 1. æ¸²æŸ“åŸºç¡€çŸ©å½¢å’Œä¸»æ ‡é¢˜
    super.render(attributes, container);

    // 2. æ·»åŠ å‰¯æ ‡é¢˜
    this.drawSubtitleShape(attributes, container);
  }
}

// ç¬¬äºŒæ­¥ï¼šæ³¨å†Œè‡ªå®šä¹‰èŠ‚ç‚¹
register(ExtensionCategory.NODE, 'dual-label-node', DualLabelNode);

// ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨è‡ªå®šä¹‰èŠ‚ç‚¹
const graph = new Graph({
  container: 'container',
  height: 200,
  data: {
    nodes: [
      {
        id: 'node1',
        style: { x: 100, y: 100 },
        data: {
          title: 'èŠ‚ç‚¹ A', // ä¸»æ ‡é¢˜
          subtitle: 'ä½ çš„ç¬¬ä¸€ä¸ªè‡ªå®šä¹‰èŠ‚ç‚¹', // å‰¯æ ‡é¢˜
        },
      },
    ],
  },
  node: {
    type: 'dual-label-node',
    style: {
      fill: '#7FFFD4',
      stroke: '#5CACEE',
      lineWidth: 2,
      radius: 5,
      // ä¸»æ ‡é¢˜æ ·å¼
      labelText: (d) => d.data.title,
      labelFill: '#222',
      labelFontSize: 14,
      labelFontWeight: 500,
      // å‰¯æ ‡é¢˜
      subtitle: (d) => d.data.subtitle,
    },
  },
});

graph.render();
```

### ç¬¬ä¸€æ­¥ï¼šç¼–å†™è‡ªå®šä¹‰èŠ‚ç‚¹ç±»

ç»§æ‰¿ G6 çš„ `Rect`ï¼ˆçŸ©å½¢èŠ‚ç‚¹ï¼‰ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªå‰¯æ ‡é¢˜ï¼š

```js
import { Rect, register, Graph, ExtensionCategory } from '@antv/g6';

// åˆ›å»ºè‡ªå®šä¹‰èŠ‚ç‚¹ï¼Œç»§æ‰¿è‡ª Rect
class DualLabelNode extends Rect {
  // å‰¯æ ‡é¢˜æ ·å¼
  getSubtitleStyle(attributes) {
    return {
      x: 0,
      y: 45, // æ”¾åœ¨ä¸»æ ‡é¢˜ä¸‹æ–¹
      text: attributes.subtitle || '',
      fontSize: 12,
      fill: '#666',
      textAlign: 'center',
      textBaseline: 'middle',
    };
  }

  // ç»˜åˆ¶å‰¯æ ‡é¢˜
  drawSubtitleShape(attributes, container) {
    const subtitleStyle = this.getSubtitleStyle(attributes);
    this.upsert('subtitle', 'text', subtitleStyle, container);
  }

  // æ¸²æŸ“æ–¹æ³•
  render(attributes = this.parsedAttributes, container) {
    // 1. æ¸²æŸ“åŸºç¡€çŸ©å½¢å’Œä¸»æ ‡é¢˜
    super.render(attributes, container);

    // 2. æ·»åŠ å‰¯æ ‡é¢˜
    this.drawSubtitleShape(attributes, container);
  }
}
```

### ç¬¬äºŒæ­¥ï¼šæ³¨å†Œè‡ªå®šä¹‰èŠ‚ç‚¹

ä½¿ç”¨ `register` æ–¹æ³•æ³¨å†ŒèŠ‚ç‚¹ç±»å‹ï¼Œè¿™æ · G6 æ‰èƒ½è¯†åˆ«ä½ çš„è‡ªå®šä¹‰èŠ‚ç‚¹ï¼š

```js
register(ExtensionCategory.NODE, 'dual-label-node', DualLabelNode);
```

`register` æ–¹æ³•éœ€è¦ä¸‰ä¸ªå‚æ•°ï¼š

- æ‰©å±•ç±»åˆ«ï¼š`ExtensionCategory.NODE` è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ç±»å‹
- ç±»å‹åç§°ï¼š`dual-label-node` æ˜¯æˆ‘ä»¬ç»™è¿™ä¸ªè‡ªå®šä¹‰èŠ‚ç‚¹èµ·çš„åå­—ï¼Œåç»­ä¼šåœ¨é…ç½®ä¸­ä½¿ç”¨
- ç±»å®šä¹‰ï¼š`DualLabelNode` æ˜¯æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„èŠ‚ç‚¹ç±»

### ç¬¬ä¸‰æ­¥ï¼šåº”ç”¨è‡ªå®šä¹‰èŠ‚ç‚¹

åœ¨å›¾é…ç½®ä¸­ä½¿ç”¨è‡ªå®šä¹‰èŠ‚ç‚¹ï¼š

```js
const graph = new Graph({
  data: {
    nodes: [
      {
        id: 'node1',
        style: { x: 100, y: 100 },
        data: {
          title: 'èŠ‚ç‚¹ A', // ä¸»æ ‡é¢˜
          subtitle: 'ä½ çš„ç¬¬ä¸€ä¸ªè‡ªå®šä¹‰èŠ‚ç‚¹', // å‰¯æ ‡é¢˜
        },
      },
    ],
  },
  node: {
    type: 'dual-label-node',
    style: {
      fill: '#7FFFD4',
      stroke: '#5CACEE',
      lineWidth: 2,
      radius: 8,
      // ä¸»æ ‡é¢˜æ ·å¼
      labelText: (d) => d.data.title,
      labelFill: '#222',
      labelFontSize: 14,
      labelFontWeight: 500,
      // å‰¯æ ‡é¢˜
      subtitle: (d) => d.data.subtitle,
    },
  },
});

graph.render();
```

ğŸ‰ æ­å–œï¼ä½ å·²ç»åˆ›å»ºäº†ç¬¬ä¸€ä¸ªè‡ªå®šä¹‰èŠ‚ç‚¹ã€‚å®ƒçœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä½†è¿™ä¸ªè¿‡ç¨‹åŒ…å«äº†è‡ªå®šä¹‰èŠ‚ç‚¹çš„æ ¸å¿ƒæ€æƒ³ï¼š**ç»§æ‰¿ä¸€ä¸ªåŸºç¡€èŠ‚ç‚¹ç±»å‹**ï¼Œç„¶å **é‡å†™ `render` æ–¹æ³•** æ¥æ·»åŠ è‡ªå®šä¹‰å†…å®¹ã€‚

## ç†è§£æ•°æ®æµï¼šå¦‚ä½•åœ¨è‡ªå®šä¹‰èŠ‚ç‚¹ä¸­è·å–æ•°æ®

åœ¨åˆ›å»ºå¤æ‚çš„è‡ªå®šä¹‰èŠ‚ç‚¹ä¹‹å‰ï¼Œç†è§£æ•°æ®å¦‚ä½•æµå…¥è‡ªå®šä¹‰èŠ‚ç‚¹æ˜¯éå¸¸é‡è¦çš„ã€‚G6 ä¸ºè‡ªå®šä¹‰èŠ‚ç‚¹æä¾›äº†å¤šç§æ•°æ®è·å–æ–¹å¼ï¼š

### æ–¹å¼ä¸€ï¼šé€šè¿‡ `attributes` å‚æ•°ï¼ˆæ¨èï¼‰

`render` æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•° `attributes` åŒ…å«äº†ç»è¿‡å¤„ç†çš„æ ·å¼å±æ€§ï¼ŒåŒ…æ‹¬æ•°æ®é©±åŠ¨çš„æ ·å¼ï¼š

```js
class CustomNode extends Rect {
  render(attributes, container) {
    // attributes åŒ…å«äº†æ‰€æœ‰æ ·å¼å±æ€§ï¼ŒåŒ…æ‹¬æ•°æ®é©±åŠ¨çš„æ ·å¼
    console.log('å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰å±æ€§:', attributes);

    // å¦‚æœåœ¨ style ä¸­å®šä¹‰äº† customData: (d) => d.data.someValue
    // é‚£ä¹ˆå¯ä»¥é€šè¿‡ attributes.customData è·å–
    const customValue = attributes.customData;

    super.render(attributes, container);
  }
}
```

### æ–¹å¼äºŒï¼šé€šè¿‡ `this.context.graph` è·å–åŸå§‹æ•°æ®

å½“ä½ éœ€è¦è®¿é—®èŠ‚ç‚¹çš„åŸå§‹æ•°æ®æ—¶ï¼Œå¯ä»¥é€šè¿‡å›¾å®ä¾‹è·å–ï¼š

```js
class CustomNode extends Rect {
  // ä¾¿æ·çš„æ•°æ®è·å–æ–¹æ³•
  get nodeData() {
    return this.context.graph.getNodeData(this.id);
  }

  get data() {
    return this.nodeData.data || {};
  }

  render(attributes, container) {
    // è·å–èŠ‚ç‚¹çš„å®Œæ•´æ•°æ®
    const nodeData = this.nodeData;
    console.log('èŠ‚ç‚¹å®Œæ•´æ•°æ®:', nodeData);

    // è·å– data å­—æ®µä¸­çš„ä¸šåŠ¡æ•°æ®
    const businessData = this.data;
    console.log('ä¸šåŠ¡æ•°æ®:', businessData);

    super.render(attributes, container);
  }
}
```

### æ•°æ®ä¼ é€’çš„å®Œæ•´æµç¨‹

è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå…·ä½“ä¾‹å­æ¥ç†è§£æ•°æ®æ˜¯å¦‚ä½•ä»å›¾æ•°æ®ä¼ é€’åˆ°è‡ªå®šä¹‰èŠ‚ç‚¹çš„ï¼š

```js | ob { inject: true }
import { Graph, register, Rect, ExtensionCategory } from '@antv/g6';

class DataFlowNode extends Rect {
  // æ–¹å¼äºŒï¼šé€šè¿‡ graph è·å–åŸå§‹æ•°æ®
  get nodeData() {
    return this.context.graph.getNodeData(this.id);
  }

  get data() {
    return this.nodeData.data || {};
  }

  render(attributes, container) {
    // æ–¹å¼ä¸€ï¼šä» attributes è·å–å¤„ç†åçš„æ ·å¼
    console.log('ä» attributes è·å–:', {
      iconUrl: attributes.iconUrl,
      userName: attributes.userName,
    });

    // æ–¹å¼äºŒï¼šä»åŸå§‹æ•°æ®è·å–
    console.log('ä»åŸå§‹æ•°æ®è·å–:', {
      icon: this.data.icon,
      name: this.data.name,
      role: this.data.role,
    });

    // æ¸²æŸ“åŸºç¡€çŸ©å½¢
    super.render(attributes, container);

    // ä½¿ç”¨æ•°æ®æ¸²æŸ“è‡ªå®šä¹‰å†…å®¹
    if (attributes.iconUrl) {
      this.upsert(
        'icon',
        'image',
        {
          x: -25,
          y: -12,
          width: 20,
          height: 20,
          src: attributes.iconUrl,
        },
        container,
      );
    }

    if (attributes.userName) {
      this.upsert(
        'username',
        'text',
        {
          x: 10,
          y: 0,
          text: attributes.userName,
          fontSize: 10,
          fill: '#666',
          textAlign: 'center',
          textBaseline: 'middle',
        },
        container,
      );
    }
  }
}

register(ExtensionCategory.NODE, 'data-flow-node', DataFlowNode);

const graph = new Graph({
  container: 'container',
  height: 200,
  data: {
    nodes: [
      {
        id: 'user1',
        style: { x: 100, y: 100 },
        // è¿™é‡Œæ˜¯èŠ‚ç‚¹çš„ä¸šåŠ¡æ•°æ®
        data: {
          name: 'å¼ ä¸‰',
          role: 'å¼€å‘è€…',
          icon: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Felix',
        },
      },
    ],
  },
  node: {
    type: 'data-flow-node',
    style: {
      size: [80, 40],
      fill: '#f0f9ff',
      stroke: '#0ea5e9',
      lineWidth: 1,
      radius: 4,
      // å°† data ä¸­çš„æ•°æ®æ˜ å°„åˆ°æ ·å¼å±æ€§
      iconUrl: (d) => d.data.icon, // è¿™ä¼šå˜æˆ attributes.iconUrl
      userName: (d) => d.data.name, // è¿™ä¼šå˜æˆ attributes.userName
      // ä¸»æ ‡é¢˜ä½¿ç”¨è§’è‰²ä¿¡æ¯
      labelText: (d) => d.data.role,
      labelFontSize: 12,
      labelFill: '#0369a1',
    },
  },
});

graph.render();
```

:::tip{title=æ•°æ®æµæ€»ç»“}

1. **å›¾æ•°æ®å®šä¹‰**ï¼šåœ¨ `data.nodes[].data` ä¸­å®šä¹‰ä¸šåŠ¡æ•°æ®
2. **æ ·å¼æ˜ å°„**ï¼šåœ¨ `node.style` ä¸­ä½¿ç”¨å‡½æ•°å°†æ•°æ®æ˜ å°„åˆ°æ ·å¼å±æ€§
3. **èŠ‚ç‚¹è·å–**ï¼šåœ¨è‡ªå®šä¹‰èŠ‚ç‚¹ä¸­é€šè¿‡ `attributes` æˆ– `this.context.graph` è·å–æ•°æ®
4. **æ¸²æŸ“ä½¿ç”¨**ï¼šä½¿ç”¨è·å–åˆ°çš„æ•°æ®æ¸²æŸ“è‡ªå®šä¹‰å›¾å½¢
   :::

## ä»ç®€å•åˆ°å¤æ‚ï¼šé€æ­¥æ„å»ºåŠŸèƒ½ä¸°å¯Œçš„èŠ‚ç‚¹

è®©æˆ‘ä»¬é€šè¿‡å®é™…ä¾‹å­ï¼Œé€æ­¥å¢åŠ èŠ‚ç‚¹çš„å¤æ‚åº¦å’ŒåŠŸèƒ½ã€‚

### ç¤ºä¾‹ä¸€ï¼šå¸¦å›¾æ ‡å’Œå¾½ç« çš„ç”¨æˆ·å¡ç‰‡èŠ‚ç‚¹

è¿™ä¸ªä¾‹å­å±•ç¤ºå¦‚ä½•åˆ›å»ºä¸€ä¸ªåŒ…å«å¤´åƒã€å§“åã€çŠ¶æ€å¾½ç« çš„ç”¨æˆ·å¡ç‰‡èŠ‚ç‚¹ï¼š

```js | ob { inject: true }
import { Graph, register, Rect, ExtensionCategory } from '@antv/g6';

class UserCardNode extends Rect {
  get nodeData() {
    return this.context.graph.getNodeData(this.id);
  }

  get data() {
    return this.nodeData.data || {};
  }

  // å¤´åƒæ ·å¼
  getAvatarStyle(attributes) {
    const [width, height] = this.getSize(attributes);
    return {
      x: -width / 2 + 20,
      y: -height / 2 + 15,
      width: 30,
      height: 30,
      src: attributes.avatarUrl || '',
      radius: 15, // åœ†å½¢å¤´åƒ
    };
  }

  drawAvatarShape(attributes, container) {
    if (!attributes.avatarUrl) return;

    const avatarStyle = this.getAvatarStyle(attributes);
    this.upsert('avatar', 'image', avatarStyle, container);
  }

  // çŠ¶æ€å¾½ç« æ ·å¼
  getBadgeStyle(attributes) {
    const [width, height] = this.getSize(attributes);
    const status = this.data.status || 'offline';
    const colorMap = {
      online: '#52c41a',
      busy: '#faad14',
      offline: '#8c8c8c',
    };

    return {
      x: width / 2 - 8,
      y: -height / 2 + 8,
      r: 4,
      fill: colorMap[status],
      stroke: '#fff',
      lineWidth: 2,
    };
  }

  drawBadgeShape(attributes, container) {
    const badgeStyle = this.getBadgeStyle(attributes);
    this.upsert('badge', 'circle', badgeStyle, container);
  }

  // ç”¨æˆ·åæ ·å¼
  getUsernameStyle(attributes) {
    const [width, height] = this.getSize(attributes);
    return {
      x: -width / 2 + 55,
      y: -height / 2 + 20,
      text: attributes.username || '',
      fontSize: 14,
      fill: '#262626',
      fontWeight: 'bold',
      textAlign: 'left',
      textBaseline: 'middle',
    };
  }

  drawUsernameShape(attributes, container) {
    if (!attributes.username) return;

    const usernameStyle = this.getUsernameStyle(attributes);
    this.upsert('username', 'text', usernameStyle, container);
  }

  // è§’è‰²æ ‡ç­¾æ ·å¼
  getRoleStyle(attributes) {
    const [width, height] = this.getSize(attributes);
    return {
      x: -width / 2 + 55,
      y: -height / 2 + 35,
      text: attributes.userRole || '',
      fontSize: 11,
      fill: '#8c8c8c',
      textAlign: 'left',
      textBaseline: 'middle',
    };
  }

  drawRoleShape(attributes, container) {
    if (!attributes.userRole) return;

    const roleStyle = this.getRoleStyle(attributes);
    this.upsert('role', 'text', roleStyle, container);
  }

  render(attributes, container) {
    // æ¸²æŸ“åŸºç¡€çŸ©å½¢
    super.render(attributes, container);

    // æ·»åŠ å„ä¸ªç»„ä»¶
    this.drawAvatarShape(attributes, container);
    this.drawBadgeShape(attributes, container);
    this.drawUsernameShape(attributes, container);
    this.drawRoleShape(attributes, container);
  }
}

register(ExtensionCategory.NODE, 'user-card-node', UserCardNode);

const graph = new Graph({
  container: 'container',
  height: 200,
  data: {
    nodes: [
      {
        id: 'user1',
        style: { x: 100, y: 100 },
        data: {
          name: 'å¼ å°æ˜',
          role: 'å‰ç«¯å·¥ç¨‹å¸ˆ',
          status: 'online',
          avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Zhang',
        },
      },
    ],
  },
  node: {
    type: 'user-card-node',
    style: {
      size: [140, 50],
      fill: '#ffffff',
      stroke: '#d9d9d9',
      lineWidth: 1,
      radius: 6,
      // æ•°æ®æ˜ å°„
      avatarUrl: (d) => d.data.avatar,
      username: (d) => d.data.name,
      userRole: (d) => d.data.role,
    },
  },
});

graph.render();
```

### ç¤ºä¾‹äºŒï¼šå¯ç‚¹å‡»æ“ä½œæŒ‰é’®çš„èŠ‚ç‚¹

ç»™èŠ‚ç‚¹åŠ ä¸€ä¸ªè“è‰²æŒ‰é’®ï¼Œç‚¹å‡»åè§¦å‘äº‹ä»¶ï¼ˆæ‰“å°æ—¥å¿—æˆ–æ‰§è¡Œå›è°ƒï¼‰ã€‚

```js | ob { inject: true }
import { Graph, register, Rect, ExtensionCategory } from '@antv/g6';

class ClickableNode extends Rect {
  getButtonStyle(attributes) {
    return {
      x: 40,
      y: -10,
      width: 20,
      height: 20,
      radius: 10,
      fill: '#1890ff',
      cursor: 'pointer', // é¼ æ ‡æŒ‡é’ˆå˜ä¸ºæ‰‹å‹
    };
  }

  drawButtonShape(attributes, container) {
    const btnStyle = this.getButtonStyle(attributes, container);
    const btn = this.upsert('button', 'rect', btnStyle, container);

    // ä¸ºæŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
    if (!btn.__clickBound) {
      btn.addEventListener('click', (e) => {
        // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œé¿å…è§¦å‘èŠ‚ç‚¹çš„ç‚¹å‡»äº‹ä»¶
        e.stopPropagation();

        // æ‰§è¡Œä¸šåŠ¡é€»è¾‘
        console.log('Button clicked on node:', this.id);

        // å¦‚æœæ•°æ®ä¸­æœ‰å›è°ƒå‡½æ•°ï¼Œåˆ™è°ƒç”¨
        if (typeof attributes.onButtonClick === 'function') {
          attributes.onButtonClick(this.id, this.data);
        }
      });
      btn.__clickBound = true; // æ ‡è®°å·²ç»‘å®šäº‹ä»¶ï¼Œé¿å…é‡å¤ç»‘å®š
    }
  }

  render(attributes, container) {
    super.render(attributes, container);

    // æ·»åŠ ä¸€ä¸ªæŒ‰é’®
    this.drawButtonShape(attributes, container);
  }
}

register(ExtensionCategory.NODE, 'clickable-node', ClickableNode);

const graph = new Graph({
  container: 'container',
  height: 200,
  data: {
    nodes: [
      {
        id: 'node1',
        style: { x: 100, y: 100 },
      },
    ],
  },
  node: {
    type: 'clickable-node', // æŒ‡å®šä½¿ç”¨æˆ‘ä»¬çš„è‡ªå®šä¹‰èŠ‚ç‚¹
    style: {
      size: [60, 30],
      fill: '#7FFFD4',
      stroke: '#5CACEE',
      lineWidth: 2,
      radius: 5,
      onButtonClick: (id, data) => {},
    },
  },
});

graph.render();
```

### ç¤ºä¾‹ä¸‰ï¼šå“åº”çŠ¶æ€å˜åŒ–çš„èŠ‚ç‚¹ï¼ˆç‚¹å‡»å˜è‰²ï¼‰

å¸¸è§çš„äº¤äº’éƒ½éœ€è¦èŠ‚ç‚¹å’Œè¾¹é€šè¿‡æ ·å¼å˜åŒ–åšå‡ºåé¦ˆï¼Œä¾‹å¦‚é¼ æ ‡ç§»åŠ¨åˆ°èŠ‚ç‚¹ä¸Šã€ç‚¹å‡»é€‰ä¸­èŠ‚ç‚¹/è¾¹ã€é€šè¿‡äº¤äº’æ¿€æ´»è¾¹ä¸Šçš„äº¤äº’ç­‰ï¼Œéƒ½éœ€è¦æ”¹å˜èŠ‚ç‚¹å’Œè¾¹çš„æ ·å¼ï¼Œæœ‰ä¸¤ç§æ–¹å¼æ¥å®ç°è¿™ç§æ•ˆæœï¼š

1. ä» `data.states` è·å–å½“å‰çŠ¶æ€ï¼Œåœ¨è‡ªå®šä¹‰èŠ‚ç‚¹ç±»ä¸­å¤„ç†çŠ¶æ€å˜åŒ–ï¼›
2. å°†äº¤äº’çŠ¶æ€åŒåŸå§‹æ•°æ®å’Œç»˜åˆ¶èŠ‚ç‚¹çš„é€»è¾‘åˆ†å¼€ï¼Œä»…æ›´æ–°èŠ‚ç‚¹ã€‚

æˆ‘ä»¬æ¨èç”¨æˆ·ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼æ¥å®ç°èŠ‚ç‚¹çš„çŠ¶æ€è°ƒæ•´ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥å®ç°ï¼š

1. å®ç°è‡ªå®šä¹‰èŠ‚ç‚¹ï¼›
2. åœ¨å›¾é…ç½®é¡¹ä¸­é…ç½®èŠ‚ç‚¹çŠ¶æ€æ ·å¼ï¼›
3. é€šè¿‡ `graph.setElementState()` æ–¹æ³•æ¥è®¾ç½®èŠ‚ç‚¹çŠ¶æ€ã€‚

åŸºäº rect æ‰©å±•å‡ºä¸€ä¸ª hole å›¾å½¢ï¼Œé»˜è®¤å¡«å……è‰²ä¸ºç™½è‰²ï¼Œå½“é¼ æ ‡ç‚¹å‡»æ—¶å˜æˆæ©™è‰²ï¼Œå®ç°è¿™ä¸€æ•ˆæœçš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```js | ob { inject: true }
import { Rect, register, Graph, ExtensionCategory } from '@antv/g6';

// 1. å®šä¹‰èŠ‚ç‚¹ç±»
class SelectableNode extends Rect {
  getHoleStyle(attributes) {
    return {
      x: 20,
      y: -10,
      radius: 10,
      width: 20,
      height: 20,
      fill: attributes.holeFill,
    };
  }

  drawHoleShape(attributes, container) {
    const holeStyle = this.getHoleStyle(attributes, container);

    this.upsert('hole', 'rect', holeStyle, container);
  }

  render(attributes, container) {
    super.render(attributes, container);

    this.drawHoleShape(attributes, container);
  }
}

// 2. æ³¨å†ŒèŠ‚ç‚¹
register(ExtensionCategory.NODE, 'selectable-node', SelectableNode, true);

// 3. åˆ›å»ºå›¾å®ä¾‹
const graph = new Graph({
  container: 'container',
  height: 200,
  data: {
    nodes: [{ id: 'node-1', style: { x: 100, y: 100 } }],
  },
  node: {
    type: 'selectable-node',
    style: {
      size: [120, 60],
      radius: 6,
      fill: '#7FFFD4',
      stroke: '#5CACEE',
      lineWidth: 2,
      holeFill: '#fff',
    },
    state: {
      // é¼ æ ‡é€‰ä¸­çŠ¶æ€
      selected: {
        holeFill: 'orange',
      },
    },
  },
});

// 4. æ·»åŠ èŠ‚ç‚¹äº¤äº’
graph.on('node:click', (evt) => {
  const nodeId = evt.target.id;

  graph.setElementState(nodeId, ['selected']);
});

graph.render();
```
